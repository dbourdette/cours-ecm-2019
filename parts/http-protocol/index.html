<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- font awesome -->
    <link href="../../common/fontawesome-free-5.9.0-web/css/all.css" rel="stylesheet">

    <!-- highlight.js -->
    <link rel="stylesheet" href="../../common/highlightjs/styles/a11y-dark.css">

    <!-- lightbox -->
    <link rel="stylesheet" href="../../common/fancybox/dist/jquery.fancybox.min.css" />

    <!-- Custom CSS -->
    <link href="../../common/prez/style.css" rel="stylesheet" media="screen">

    <title>Protocol HTTP</title>
</head>
<body>
<div class="container ">
    <h1>Le protocole HTTP</h1>

    <p>Il permet d'échanger des données avec des serveurs</p>

    <p>Avec un navigateur web, il permet principalement de lire des pages web</p>

    <img src="request-response.png" alt="" class="img-thumbnail mx-auto d-block">

    <p>Une page web contient de références vers des dizaines d'autres ressources (images, scripts, feuilles de style...)</p>

    <h2>Une reqête HTTP</h2>

    <p>Une requête HTTP contient :</p>

    <ul>
        <li>une ligne de requête : composé d'une <strong>méthode</strong>, le <strong>chemin</strong> et la version du protocole.</li>
        <li>des <strong>en-têtes</strong> : des clés / valeurs donnant des indications supplémentaires.</li>
        <li>un <strong>corps</strong> : des blocs de données supplémentaires utiles pour envoyer du contenu.</li>
    </ul>

    <pre>GET /actualites HTTP/1.1
Host: www.rtl.fr
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 115
Connection: keep-alive
Referer: http://www.rtl.fr/</pre>

    <p>La première ligne contient la méthode : c'est l'action demandée par le client sur la ressource</p>

    <table class="table table-dark table-striped table-sm">
        <thead class="thead-dark">
            <tr>
                <td>méthode</td>
                <td>description</td>
                <td style="text-align:center;">sûre</td>
                <td style="text-align:center;">idempotente</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>GET</td>
                <td>Le client demande une ressource</td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
            </tr>
            <tr>
                <td>POST</td>
                <td>Le client demande la création d'une ressource</td>
                <td style="text-align:center;"><img src="no.png" alt=""></td>
                <td style="text-align:center;"><img src="no.png" alt=""></td>
            </tr>
            <tr>
                <td>PUT</td>
                <td>Le client envoie une ressource vers une url</td>
                <td style="text-align:center;"><img src="no.png" alt=""></td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
            </tr>
            <tr>
                <td>DELETE</td>
                <td>Le client demande la suppression d'une ressource</td>
                <td style="text-align:center;"><img src="no.png" alt=""></td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
            </tr>
            <tr>
                <td>HEAD</td>
                <td>Le client demande des informations sur la ressource, sans la demander elle-même</td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
            </tr>
            <tr>
                <td>OPTIONS</td>
                <td>Permet d'obtenir les options de communication d'une ressource ou du serveur en général</td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
                <td style="text-align:center;"><img src="ok.png" alt=""></td>
            </tr>
        </tbody>
    </table>

    <p>Seuls GET et POST sont possibles depuis un navigateur</p>

    <p>Les headers permettent d'ajouter de l'information sur la nature de la requête</p>

    <p>Voci quelques exemples</p>

    <table class="table table-dark table-striped table-sm">
        <thead class="thead-dark">
        <tr>
            <td>header</td>
            <td>description</td>
            <td>exemple</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Host</td>
            <td>Le domaine vers lequel est fait la requête</td>
            <td>Host: www.rtl.fr</td>
        </tr>
        <tr>
            <td>Referer</td>
            <td>Adresse de la page web précédent cette requête</td>
            <td>Referer: http://www.rtl.fr</td>
        </tr>
        <tr>
            <td>Accept</td>
            <td>Types de contenu acceptés par le navigateur</td>
            <td>Accept: text/plain</td>
        </tr>
        <tr>
            <td>Accept-Language</td>
            <td>Language acceptés par le navigateur</td>
            <td>Accept-Language: fr-fr</td>
        </tr>
        </tbody>
    </table>

    <p>Cette liste est loin d'être figée</p>

    <h2>Une réponse HTTP</h2>

    <p>Une réponse HTTP contient :</p>

    <ul>
        <li>une ligne de statut : la version du protocole, le <strong>code de retour</strong> avec son libellé associé</li>
        <li>des <strong>en-têtes</strong> : des clés / valeurs donnant des indications supplémentaires</li>
        <li>un corps : la ressource demandée</li>
    </ul>

    <pre>HTTP/1.1 200 OK
Content-Type: text/html;charset=UTF-8
Content-Language: fr-FR
Content-Length: 57366
Date: Wed, 03 Nov 2010 21:42:30 GMT
Connection: keep-alive

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"&gt;
   &lt;head&gt;…&lt;/head&gt;
   &lt;body&gt;
      …
   &lt;/body&gt;
&lt;/html&gt;</pre>

    <p>Le <a href="https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP" target="_blank">code de retour</a> résume le résultat de l'éxécution de la requête</p>

    <table class="table table-dark table-striped table-sm">
        <thead class="thead-dark">
            <tr>
                <td>code</td>
                <td>signification</td>
                <td>description</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>2xx</td>
                <td>Succès</td>
                <td>Tous les codes de succès</td>
            </tr>
            <tr>
                <td>200</td>
                <td>OK</td>
                <td>Le corps contient le document demandé</td>
            </tr>
            <tr>
                <td>3xx</td>
                <td>Redirection</td>
                <td>Le client est rédirigé</td>
            </tr>
            <tr>
                <td>301</td>
                <td>Move permanently</td>
                <td>Document déplacé de façon permanente</td>
            </tr>
            <tr>
                <td>302</td>
                <td>Found (Moved temporarly)</td>
                <td>Document déplacé de façon temporaire</td>
            </tr>
            <tr>
                <td>304</td>
                <td>Not modified</td>
                <td>Document non modifié depuis la dernière requête</td>
            </tr>
            <tr>
                <td>4xx</td>
                <td>Erreur du client</td>
                <td>La requête ne peut aboutir à cause du client</td>
            </tr>
            <tr>
                <td>400</td>
                <td>Bad Request</td>
                <td>La syntaxe de la requête est erronée</td>
            </tr>
            <tr>
                <td>401</td>
                <td>Unauthorized</td>
                <td>Une authentification est nécessaire</td>
            </tr>
            <tr>
                <td>404</td>
                <td>Not found</td>
                <td>Document non trouvé</td>
            </tr>
            <tr>
                <td>5xx</td>
                <td>Erreur du serveur</td>
                <td>Le serveur n'a pu répondre correctement</td>
            </tr>
            <tr>
                <td>500</td>
                <td>Internal server error</td>
                <td>Erreur interne du serveur</td>
            </tr>
        </tbody>
    </table>

    <p>Et également quelques exemples de headers de réponse</p>

    <table class="table table-dark table-striped table-sm">
        <thead class="thead-dark">
        <tr>
            <td>header</td>
            <td>description</td>
            <td>exemple</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Content-Type</td>
            <td>Le type MIME de ce document</td>
            <td>Content-Type: text/html; charset=utf-8</td>
        </tr>
        <tr>
            <td>Content-Length</td>
            <td>La taille du document en octets</td>
            <td>Content-Length: 348</td>
        </tr>
        <tr>
            <td>Cache-Control</td>
            <td>Comment le document peut être mis en cache</td>
            <td>Cache-Control: public, max-age=60 fr-fr</td>
        </tr>
        <tr>
            <td>Age</td>
            <td>Le document est en cache dans un proxy depuis ce temps</td>
            <td>Age: 12</td>
        </tr>
        </tbody>
    </table>

    <h2>Outils</h2>

    <p>Le navigateur web est l'outil le plus courant pour faire du HTTP</p>

    <p>Mais si il permet de visualiser les pages, il ne permet pas de facilement modeler des requêtes</p>

    <h3>curl</h3>

    <p>curl (<a href="https://curl.haxx.se/" target="_blank">client URL request library</a>) est l'outil canonique pour tester des requêtes</p>

    <p>➤ Par exemple, tester ce service en local</p>

    <pre><code class="groovy">@RestController
class Hello {
    @RequestMapping("/")
    String home() {
        "Hello CURL!"
    }
}</code></pre>

    <pre><code class="terminal">$ curl -s http://localhost:8080
Hello CURL!</code></pre>

    <div class="bd-callout bd-callout-warning">
        <p>Sous windows faites un shift click sur Git Bash pour ouvrir plusieurs fenêtres</p>

        <img src="multiple.png" alt="">
    </div>

    <p>➤ Afficher les headers de réponse (l'option -I engendre une requête de type HEAD)</p>

    <pre><code class="terminal">$ curl -sI http://localhost:8080
HTTP/1.1 200
Content-Type: text/plain;charset=UTF-8
Content-Length: 11
Date: Fri, 14 Jun 2019 06:55:33 GMT</code></pre>

    <p>Si on change notre <code>Controller</code> afin de n'accepter que le POST</p>

    <pre><code class="groovy">@RestController
class Hello {
    @PostMapping("/")
    String home() {
        "Hello CURL!"
    }
}</code></pre>

    <p>➤ Tester un GET : le serveur retourne une erreur</p>

    <div class="bd-callout bd-callout-warning">
        <p>Pensez à redémarrer le serveur</p>
    </div>

    <pre><code class="terminal">$ curl -sI http://localhost:8080
{"timestamp":"2019-06-14T06:58:34.357+0000","status":405,"error":"Method Not Allowed","message":"Request method 'GET' not supported","path":"/"}</code></pre>

    <p>➤ Il faut donc desormais faire un POST</p>

    <pre><code class="terminal">$ curl -s -X POST http://localhost:8080
Hello CURL!</code></pre>

    <p>Il est possible de forger tous types de requêtes avec curl. C'est un outil simple et utile pour débugger</p>

    <h3>Postman</h3>

    <p><a href="https://www.getpostman.com/products" target="_blank">Postman</a> est un outil graphique pour forger des requêtes</p>

    <p>➤ Installez Postman</p>

    <div class="bd-callout bd-callout-warning">
        <p>La création de compte est optionelle : <em>Skip signing in and take me straight to the app</em></p>
    </div>

    <p>➤ Remodifier le code afin de repasser en GET</p>

    <pre><code class="groovy">@RestController
class Hello {
    @GetMapping("/")
    String home() {
        "Hello Postman!"
    }
}</code></pre>
    
    <p>➤ Et tester l'application</p>

    <a data-fancybox="gallery" href="postman-get.png">
        <img src="postman-get.png" alt="" class="img-thumbnail mx-auto d-block">
    </a>

    <h3>json</h3>

    <p>Très couramment on utilise du <a href="https://www.json.org/" target="_blank">json</a> comme format de données</p>

    <p>C'est un format assez simple à lire et écrire et surtout, il est compatible avec beaucoup de d'environnement</p>

    <p>➤ Tester le code suivant avec Postman</p>

    <pre><code class="groovy">@RestController
class Hello {
    @GetMapping("/")
    Map home() {
        [action: 'Hello', name: 'Postman']
    }
}</code></pre>

    <p>➤ Quelle est la valeur du header <code>Content-Type</code> en retour ?</p>

    <p>Repassons en POST afin de pouvoir envoyer des données dans le corps de la requête</p>

    <p>➤ Changez le code pour le suivant</p>

    <pre><code class="groovy">@RestController
class Hello {
    @PostMapping("/")
    Map home(@RequestBody Map params) {
        [action: 'Hello', name: params.name]
    }
}</code></pre>

    <p>➤ Et tester avec un appel en POST contenant du json</p>

    <a data-fancybox="gallery" href="postman-post-json.png">
        <img src="postman-post-json.png" alt="" class="img-thumbnail mx-auto d-block">
    </a>

    <p>➤ Quelle est la valeur du header <code>Content-Type</code> dans la requête ?</p>

    <a href="../../index.html" class="home"><i class="fas fa-home"></i> home</a>
</div>
<!-- presentation -->

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<!-- highlight.js -->
<script src="../../common/highlightjs/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- lightbox -->
<script src="../../common/fancybox/dist/jquery.fancybox.min.js"></script>


<script src="../../common/prez/prez.js"></script>

</body>
</html>